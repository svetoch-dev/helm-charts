replicas: 2
users: {}
dockerImage: ""
databases: {}
preparedDatabases: {}
postgresql:
  parameters:
    password_encryption: scram-sha-256
    #Common paramters for
    #improving performance on ssd disks
    random_page_cost: '1.1'
    effective_io_concurrency: '200'
    log_destination: 'jsonlog'
env: {}
volume: {}
podAnnotations: {}
serviceAnnotations: {}
tolerations: {}
resources: {}
patroni: {}
logicalBackup:
  enabled: false
  schedule: "30 00 * * *"
connectionPooler: {}
sidecars: {}
defaultSidecars:
  enabled: false
  pgExporterImage: "{{ $.Values.global.registry.url}}/postgres-exporter:v0.17.1-3"
teamId: "main"
nodeAffinity: {}
podMonitor:
  enabled: false
  labels: {}
  prometheusSelector: {}
  podTargetLabels: []
  podMetricsEndpoints: {}

fluentbit:
  enabled: false
  filters:
  - name: parser
    match: '*'
    key_name: log
    parser: json
  - name: modify
    match: '*'
    hard_rename:
    - error_severity level
    - ps session_state
  - name: lua
    match: "*"
    code: |
      function level_lower_case(tag, timestamp, record)
          code = 0
          if record["level"] then
              if record["level"] == "WARNING" then
                  record["level"] = "warn"
              end
              if record["level"] == "LOG" then
                  record["level"] = "info"
              end
              if string.match(record["level"], "DEBUG") then
                  record["level"] = "debug"
              end
              record["level"] = string.lower(tostring(record["level"]))
              code = 1
          end
          return code, timestamp, record
      end
    call: level_lower_case
  parsers:
    json:
      name: json
      format: json
      time_key: timestamp
      time_format: '%Y-%m-%d %H:%M:%S.%L %Z'

secrets:
  fluentbit-config:
    data:
      fluent-bit.yaml: |
        {{- range $name, $parser := .Values.fluentbit.parsers }}
        parsers:
        - {{ toYaml $parser | nindent 2 | trim }}
        {{- end }}
        pipeline:
          {{- if .Values.fluentbit.inputs }}
          inputs:
          {{- range $name, $input := .Values.fluentbit.inputs }}
          - {{ tpl (toYaml $input) $ | nindent 4 | trim }}
          {{- end }}
          {{- end }}
          {{- if .Values.fluentbit.filters }}
          filters:
          {{- range $filter := .Values.fluentbit.filters }}
          - {{ tpl (toYaml $filter) $ | nindent 4 | trim }}
          {{- end }}
          {{- end }}
          {{- if .Values.fluentbit.filters }}
          outputs:
          {{- range $name, $output := .Values.fluentbit.outputs }}
          {{- if eq $output.name "loki" }}
          {{- $labels := list }}
          {{- range $label_name, $label_value := $output.labels }}
          {{- $labels = append $labels (printf "%s=%s" $label_name $label_value) }}
          {{- end }}
          {{- $output := set $output "labels" (join "," $labels )}}
          {{- end }}
          - {{ tpl (toYaml $output) $ | nindent 4 | trim }}
          {{- end }}
          {{- end }}
