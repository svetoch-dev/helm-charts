{{- range $dbName, $db_obj := .Values.dashboards }}
{{- if $db_obj.enabled }}

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  labels:
{{- include "grafana-dashboards.labels" $ | nindent 4 }}
  name: {{ tpl $dbName $ }}
spec:
  {{- with $db_obj.selector }}
  instanceSelector:
    matchLabels:
    {{- toYaml . | nindent 6 }}
  {{- end }}
  resyncPeriod: {{ $db_obj.resyncPeriod | default "30s" }}
  {{- if $db_obj.allowCrossNamespaceImport }}
  allowCrossNamespaceImport: {{ $db_obj.allowCrossNamespaceImport }}
  {{- end }}
  {{- if $db_obj.jsonnet }}
  jsonnet: {{ toYaml $db_obj.jsonnet | nindent 4 }}
  {{- end }}
  {{- if $db_obj.gzipJson }}
  gzipJson: {{ toYaml $db_obj.gzipJson | nindent 4 }}
  {{- end }}
  {{- if $db_obj.json }}
  json: {{ toYaml $db_obj.json | nindent 4 }}
  {{- end }}
  {{- if $db_obj.folder }}
  folder: {{ $db_obj.folder }}
  {{- end }}
  {{- if $db_obj.url }}
  url: {{ $db_obj.url }}
  {{- end }}
  {{- if $db_obj.contentCacheDuration }}
  contentCacheDuration: {{ $db_obj.contentCacheDuration }}
  {{- end }}
  {{- with $db_obj.datasource }}
  datasource:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.plugins }}
  plugins:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.configMapRef }}
  configMapRef:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.envFrom }}
  envFrom:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.envs }}
  envs:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.grafanaCom }}
  grafanaCom:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}
  {{- with $db_obj.jsonnetLib }}
  jsonnetLib:
  {{- tpl (toYaml .) $ | nindent 4 }}
  {{- end }}

{{- end }}
{{- end }}
